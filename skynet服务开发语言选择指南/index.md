# Skynet服务开发语言选择指南



<!--more-->


在 Skynet 框架中，选择使用 C 语言还是 Lua 语言编写服务需要根据具体场景来决定。以下是建议使用 C 语言编写 Skynet 服务的情况：
1.高性能计算密集型任务（数学计算、加密解密、数据压缩等）
2.底层系统操作（文件 I/O、网络套接字、设备操作等；skynet提供的logger就是通过C服务编写的）
3.与现有C/C++库集成(kafka的C库、音视频编解码库FFmpeg、图像处理库OpenCV等)
4.协议解析和序列化(自定义二进制协议、Protobuf/FlatBuffers处理、实时数据流解析等)


## 📊决策矩阵
| 场景	      |推荐语言	   | 理由
| :---------- | :-------: | :--------------:           |
| 业务逻辑     | Lua       |  开发效率高，热更新方便      |
| 高性能计算   |  C	       |  执行效率高，硬件控制强      |
| 系统底层操作 |  C        |  直接系统调用，无额外开销    |
| 内存敏感     |  C        |	精细内存控制，避免GC       |
| 第三方库集成 |  C        | 直接调用，无绑定层开销       |
| 协议解析     |  C       | 处理速度快，内存效率高       |



## 📈性能对比考虑

| 指标	     |   C 语言	       |     Lua 语言   
| :---------- | :-------: | :--------------:           |
| 执行速度  |  ⭐⭐⭐⭐⭐      |	⭐⭐    |
| 开发效率  |  ⭐⭐	           |  ⭐⭐⭐⭐⭐    |
| 内存控制  |  ⭐⭐⭐⭐⭐	     |⭐⭐    |
| 热更新	   |  ⭐	           |   ⭐⭐⭐⭐⭐    |
| 系统集成  |  ⭐⭐⭐⭐⭐	     |⭐⭐    |

## 🎯 总结建议

### 使用 C 语言当：
* 性能是首要考虑因素
* 需要直接操作系统资源
* 集成现有 C/C++ 生态
* 处理大量二进制数据
* 对内存使用有严格要求

### 使用 Lua 语言当：
* 开发速度更重要
* 需要频繁修改和热更新
* 业务逻辑复杂多变
* 团队 Lua 技能更熟练
* 性能要求不是极端严格

### 混合开发建议(C + Lua 混合模式)
在实际项目中，通常采用混合架构：用 C 实现底层基础设施和性能关键组件，用 Lua 实现业务逻辑和上层应用。
例如常用json库就是通过C语言编写成lua模块(这类模块在linux中一般以.so结尾)。
json.decode、json.encode这类接口都属于主动调用的场景使用的。但有时我们不得不被动调用某些接口，如使用了某些第三方C库，需要绑定回调时，这时我们无法直接去唤醒服务来调用函数(这会打断skynet的底层调度)。
这里提供了2个方案解决这类问题：
1. 在C回调中把需要用到的数据用C缓存起来，在lua服务中定时消费掉缓存数据。
2. 在C回调中直接将消息加入服务队列，这需要维护好skynet的服务地址。
